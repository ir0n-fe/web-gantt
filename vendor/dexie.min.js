(function(g){
  function Table(dbName, tableName){ this.dbName = dbName; this.tableName = tableName; }
  Table.prototype._key = function(id){ return this.dbName + ':' + this.tableName + ':' + id; };
  Table.prototype.get = async function(id){
    var raw = localStorage.getItem(this._key(id));
    return raw ? JSON.parse(raw) : undefined;
  };
  Table.prototype.put = async function(value){
    var id = value && value.id ? value.id : 'default';
    localStorage.setItem(this._key(id), JSON.stringify(value));
  };

  function Dexie(name){ this.name = name; this._tables = {}; }
  Dexie.prototype.version = function(){
    var self = this;
    return { stores: function(schema){ self._tables = schema || {}; return self; } };
  };
  Dexie.prototype.open = async function(){ return this; };
  Dexie.prototype.table = function(name){ return new Table(this.name, name); };

  g.Dexie = Dexie;
})(window);
